"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const TraceListeners_1 = require("./TraceListeners");
const Objects_1 = require("../util/Objects");
const TraceHandler_1 = require("./TraceHandler");
const ObjectPaths_1 = require("./ObjectPaths");
const Paths_1 = require("../util/Paths");
let sequence = 0;
class Proxies {
    static create(target, traceListeners, opts) {
        if (typeof target !== "object") {
            throw new Error("Only works on objects: " + typeof target);
        }
        opts = Objects_1.Objects.defaults(opts, {
            pathPrefix: ""
        });
        if (!traceListeners) {
            traceListeners = [];
        }
        traceListeners = TraceListeners_1.TraceListeners.asArray(traceListeners);
        let objectPathEntries = ObjectPaths_1.ObjectPaths.recurse(target);
        let root;
        objectPathEntries.forEach((objectPathEntry) => {
            let path = objectPathEntry.path;
            if (opts.pathPrefix && opts.pathPrefix !== "") {
                path = Paths_1.Paths.create(opts.pathPrefix, objectPathEntry.path);
            }
            let proxy = Proxies.trace(path, objectPathEntry.value, traceListeners);
            if (objectPathEntry.parent != null) {
                objectPathEntry.parent[objectPathEntry.parentKey] = proxy;
            }
            else {
                root = proxy;
            }
        });
        return root;
    }
    static trace(path, value, traceListeners) {
        if (typeof value !== "object") {
            throw new Error("We can only trace object types.");
        }
        traceListeners = TraceListeners_1.TraceListeners.asArray(traceListeners);
        if (Object.isFrozen(value)) {
            return value;
        }
        let traceIdentifier = sequence++;
        let traceHandler = new TraceHandler_1.TraceHandler(path, traceListeners, value, traceIdentifier, Proxies);
        let privateMembers = [];
        if (value.addTraceListener) {
            value.addTraceListener(traceListeners);
        }
        else {
            Object.defineProperty(value, "addTraceListener", {
                value: traceHandler.addTraceListener.bind(traceHandler),
                enumerable: false,
                writable: false
            });
        }
        return new Proxy(value, traceHandler);
    }
}
exports.Proxies = Proxies;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJveGllcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlByb3hpZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFTQSxxREFBZ0Q7QUFDaEQsNkNBQXdDO0FBQ3hDLGlEQUE0QztBQUM1QywrQ0FBMEM7QUFDMUMseUNBQW9DO0FBTXBDLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQztBQUVqQixNQUFhLE9BQU87SUFNVCxNQUFNLENBQUMsTUFBTSxDQUFJLE1BQVMsRUFBRSxjQUFvQixFQUFFLElBQVU7UUFFL0QsSUFBRyxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUU7WUFDM0IsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsR0FBRyxPQUFPLE1BQU0sQ0FBQyxDQUFDO1NBQzlEO1FBRUQsSUFBSSxHQUFHLGlCQUFPLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRTtZQUMxQixVQUFVLEVBQUUsRUFBRTtTQUNqQixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQ2pCLGNBQWMsR0FBRyxFQUFFLENBQUM7U0FDdkI7UUFFRCxjQUFjLEdBQUcsK0JBQWMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFeEQsSUFBSSxpQkFBaUIsR0FBRyx5QkFBVyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVwRCxJQUFJLElBQVMsQ0FBQztRQUVkLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDLGVBQWUsRUFBRSxFQUFFO1lBRTFDLElBQUksSUFBSSxHQUFHLGVBQWUsQ0FBQyxJQUFJLENBQUM7WUFFaEMsSUFBRyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLEtBQUssRUFBRSxFQUFFO2dCQUMxQyxJQUFJLEdBQUcsYUFBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUM5RDtZQUVELElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLGVBQWUsQ0FBQyxLQUFLLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFJdkUsSUFBRyxlQUFlLENBQUMsTUFBTSxJQUFJLElBQUksRUFBRTtnQkFDL0IsZUFBZSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsU0FBVSxDQUFDLEdBQUcsS0FBSyxDQUFDO2FBQzlEO2lCQUFNO2dCQUNILElBQUksR0FBRyxLQUFLLENBQUM7YUFDaEI7UUFFTCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sSUFBSSxDQUFDO0lBRWhCLENBQUM7SUFFTSxNQUFNLENBQUMsS0FBSyxDQUFDLElBQVksRUFBRSxLQUFVLEVBQUUsY0FBbUI7UUFFN0QsSUFBRyxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDMUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1NBQ3REO1FBRUQsY0FBYyxHQUFHLCtCQUFjLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRXhELElBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQVF2QixPQUFPLEtBQUssQ0FBQztTQUVoQjtRQUVELElBQUksZUFBZSxHQUFHLFFBQVEsRUFBRSxDQUFDO1FBTWpDLElBQUksWUFBWSxHQUFHLElBQUksMkJBQVksQ0FBQyxJQUFJLEVBQUUsY0FBYyxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFTM0YsSUFBSSxjQUFjLEdBQUcsRUFpQnBCLENBQUM7UUFzQkYsSUFBRyxLQUFLLENBQUMsZ0JBQWdCLEVBQUU7WUFDdkIsS0FBSyxDQUFDLGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxDQUFDO1NBQzFDO2FBQU07WUFDSCxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxrQkFBa0IsRUFBRTtnQkFDN0MsS0FBSyxFQUFFLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDO2dCQUN2RCxVQUFVLEVBQUUsS0FBSztnQkFDakIsUUFBUSxFQUFFLEtBQUs7YUFDbEIsQ0FBQyxDQUFDO1NBQ047UUFFRCxPQUFPLElBQUksS0FBSyxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztJQUUxQyxDQUFDO0NBRUo7QUExSUQsMEJBMElDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBGcmFtZXdvcmsgdG8gY3JlYXRlIGxpc3RlbmVycyB0byB3YXRjaCBjaGFuZ2VzIGluIGRpY3Rpb25hcmllcy4gIFdlIGNhblxuICogY2hhbmdlIHRoZXNlIGludG8gb2JzZXJ2YWJsZXMgaWYgd2Ugd2FudCBieSBtYWtpbmcgdGhlbSBzdHJlYW1zIG9mIFNFVCBhbmRcbiAqIERFTEVURSBvcGVyYXRpb25zIGJ1dCBzaW5jZSB3ZSdyZSBub3QgcmVhbGx5IHVzaW5nIFJ4SlMgb3IgYW55dGhpbmcgb2YgdGhlXG4gKiBzb3J0IHlldCBvdXIgb3B0aW9ucyBhcmUgb3Blbi5cbiAqXG4gKiBOb3RlIHRoYXQgT2JqZWN0Lm9ic2VydmUgYW5kIG90aGVyIGNoYW5nZXMgd2VyZSBhcHBhcmVudGx5IG5ldmVyIHJhdGlmaWVkXG4gKiBzbyB3ZSBoYXZlIHRvIHVzZSBQcm94eSBvYmplY3RzIHRvIGltcGxlbWVudCB0aGlzIGZ1bmN0aW9uYWxpdHkuXG4gKi9cbmltcG9ydCB7VHJhY2VMaXN0ZW5lcnN9IGZyb20gXCIuL1RyYWNlTGlzdGVuZXJzXCI7XG5pbXBvcnQge09iamVjdHN9IGZyb20gXCIuLi91dGlsL09iamVjdHNcIjtcbmltcG9ydCB7VHJhY2VIYW5kbGVyfSBmcm9tIFwiLi9UcmFjZUhhbmRsZXJcIjtcbmltcG9ydCB7T2JqZWN0UGF0aHN9IGZyb20gXCIuL09iamVjdFBhdGhzXCI7XG5pbXBvcnQge1BhdGhzfSBmcm9tIFwiLi4vdXRpbC9QYXRoc1wiO1xuXG4vKipcbiAqIEEgc2VxdWVuY2UgaWRlbnRpZmllciBnZW5lcmF0b3Igc28gdGhhdCB3ZSBjYW4gYXNzaWduIG9iamVjdHMgYSB1bmlxdWUgdmFsdWVcbiAqIHdoaWxlIHdlJ3JlIGVudW1lcmF0aW5nIHRoZW0uXG4gKi9cbmxldCBzZXF1ZW5jZSA9IDA7XG5cbmV4cG9ydCBjbGFzcyBQcm94aWVzIHtcblxuICAgIC8qKlxuICAgICAqIERlZXBseSB0cmFjZSB0aGUgZ2l2ZW4gb2JqZWN0IGFuZCBjYWxsIGJhY2sgb24gdGhlIHRyYWNlTGlzdGVuZXIgZXZlcnkgdGltZVxuICAgICAqIHdlIG5vdGljZSBhIG11dGF0aW9uLiAgVGhlIHRyYWNlIGxpc3RlbmVyIHJlY2VpdmVzIHRoZSBmb2xsb3dpbmcgYXJndW1lbnRzOlxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgY3JlYXRlPFQ+KHRhcmdldDogVCwgdHJhY2VMaXN0ZW5lcnM/OiBhbnksIG9wdHM/OiBhbnkpOiBUIHtcblxuICAgICAgICBpZih0eXBlb2YgdGFyZ2V0ICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJPbmx5IHdvcmtzIG9uIG9iamVjdHM6IFwiICsgdHlwZW9mIHRhcmdldCk7XG4gICAgICAgIH1cblxuICAgICAgICBvcHRzID0gT2JqZWN0cy5kZWZhdWx0cyhvcHRzLCB7XG4gICAgICAgICAgICBwYXRoUHJlZml4OiBcIlwiXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghdHJhY2VMaXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIHRyYWNlTGlzdGVuZXJzID0gW107XG4gICAgICAgIH1cblxuICAgICAgICB0cmFjZUxpc3RlbmVycyA9IFRyYWNlTGlzdGVuZXJzLmFzQXJyYXkodHJhY2VMaXN0ZW5lcnMpO1xuXG4gICAgICAgIGxldCBvYmplY3RQYXRoRW50cmllcyA9IE9iamVjdFBhdGhzLnJlY3Vyc2UodGFyZ2V0KTtcblxuICAgICAgICBsZXQgcm9vdDogYW55O1xuXG4gICAgICAgIG9iamVjdFBhdGhFbnRyaWVzLmZvckVhY2goKG9iamVjdFBhdGhFbnRyeSkgPT4ge1xuXG4gICAgICAgICAgICBsZXQgcGF0aCA9IG9iamVjdFBhdGhFbnRyeS5wYXRoO1xuXG4gICAgICAgICAgICBpZihvcHRzLnBhdGhQcmVmaXggJiYgb3B0cy5wYXRoUHJlZml4ICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgcGF0aCA9IFBhdGhzLmNyZWF0ZShvcHRzLnBhdGhQcmVmaXgsIG9iamVjdFBhdGhFbnRyeS5wYXRoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHByb3h5ID0gUHJveGllcy50cmFjZShwYXRoLCBvYmplY3RQYXRoRW50cnkudmFsdWUsIHRyYWNlTGlzdGVuZXJzKTtcblxuICAgICAgICAgICAgLy8gcmVwbGFjZSB0aGUgb2JqZWN0IGtleSBpbiB0aGUgcGFyZW50IHdpdGggYSBuZXcgb2JqZWN0IHRoYXQgaXNcbiAgICAgICAgICAgIC8vIHRyYWNlZC5cbiAgICAgICAgICAgIGlmKG9iamVjdFBhdGhFbnRyeS5wYXJlbnQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIG9iamVjdFBhdGhFbnRyeS5wYXJlbnRbb2JqZWN0UGF0aEVudHJ5LnBhcmVudEtleSFdID0gcHJveHk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJvb3QgPSBwcm94eTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcm9vdDtcblxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgdHJhY2UocGF0aDogc3RyaW5nLCB2YWx1ZTogYW55LCB0cmFjZUxpc3RlbmVyczogYW55KSB7XG5cbiAgICAgICAgaWYodHlwZW9mIHZhbHVlICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJXZSBjYW4gb25seSB0cmFjZSBvYmplY3QgdHlwZXMuXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJhY2VMaXN0ZW5lcnMgPSBUcmFjZUxpc3RlbmVycy5hc0FycmF5KHRyYWNlTGlzdGVuZXJzKTtcblxuICAgICAgICBpZihPYmplY3QuaXNGcm96ZW4odmFsdWUpKSB7XG5cbiAgICAgICAgICAgIC8vIERvIG5vdCBoYW5kbGUgZnJvemVuIG9iamVjdHMgYnV0IG1pZ2h0IGhhdmUgdG8gaW4gdGhlIGZ1dHVyZSBmb3JcbiAgICAgICAgICAgIC8vIHRoZSBpbml0aWFsIHZhbHVlLlxuXG4gICAgICAgICAgICAvLyBUT0RPOiBpdCdzIHByb2JhYmx5IGJlc3QgdG8gdGhyb3cgYW4gZXJyb3IgaGVyZSBiZWNhdXNlIHdlJ3ZlXG4gICAgICAgICAgICAvLyBiZWVuIGFza2VkIHRvIHRyYWNlIGJ1dCB3ZSdyZSBub3QgdHJhY2luZy4gIFRoaXMgaXMgYW4gQVBJIGZsYXcuXG5cbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRyYWNlSWRlbnRpZmllciA9IHNlcXVlbmNlKys7XG5cbiAgICAgICAgLy8gZm9yIHRoaXMgdG8gd29yaywgSSBuZWVkIHRvIGtlZXAgdHJhY2sgb2YgQUxMIFRyYWNlSGFuZGxlcnMgaW4gdGhlXG4gICAgICAgIC8vIG9iamVjdCBpdHNlbGYgYnkgcG9zc2libHkgaGF2aW5nIGEgX190cmFjZUhhbmRsZXJzIG9yIHNvbWUgb3RoZXJcbiAgICAgICAgLy8gc3RyYXRlZ3kgb3IgX19wYXRocyBhbmQgdGhlbiBkaXNwYXRjaCB0aGF0IHdheS4uLlxuXG4gICAgICAgIGxldCB0cmFjZUhhbmRsZXIgPSBuZXcgVHJhY2VIYW5kbGVyKHBhdGgsIHRyYWNlTGlzdGVuZXJzLCB2YWx1ZSwgdHJhY2VJZGVudGlmaWVyLCBQcm94aWVzKTtcblxuICAgICAgICAvLyBUT0RPOiBjb3VsZCBJIHN0b3JlIHRoZXNlIGluIHRoZSBUcmFjZUhhbmRsZXIgYW5kIG5vdCBpbiB0aGUgdmFsdWU/XG4gICAgICAgIC8vXG4gICAgICAgIC8vIHNpbmNlIHdlIGhhdmUgb25lIFRyYWNlSGFuZGxlciBwZXIgcGF0aCB0aGlzIG1pZ2h0IHdvcmsgYnV0IEkgd291bGRcbiAgICAgICAgLy8gbmVlZCB0byBmaWd1cmUgb3V0IGhvdyB0byBnZXQgdGhlIHJpZ2h0IHZhbHVlIGZyb20gdGhlIFRyYWNlSGFuZGxlci5cbiAgICAgICAgLy8gSSB0aGluayBJIGNhbiBkbyB0aGlzIGJ5IGN1c3RvbSBoYW5kbGluZyB0aGUgZ2V0KCkgUHJveHkgYW5kIHRoZW5cbiAgICAgICAgLy8gcmV0dXJuaW5nIF9fdHJhY2VJZGVudGlmaWVyIG9yIF9fdHJhY2VMaXN0ZW5lcnMgYmFzZWQgb24gdGhlIGNhbGxlci5cblxuICAgICAgICBsZXQgcHJpdmF0ZU1lbWJlcnMgPSBbXG5cbiAgICAgICAgICAgIC8vIHRoZSBfX3RyYWNlSWRlbnRpZmllciBpcyBhIHVuaXF1ZSBrZXkgZm9yIHRoZSBvYmplY3Qgd2hpY2ggd2UgdXNlXG4gICAgICAgICAgICAvLyB0byBpZGVudGlmeSB3aGljaCBvbmUgaXMgYmVpbmcgdHJhY2VkLiAgVGhpcyB3YXkgd2UgZXNzZW50aWFsbHlcbiAgICAgICAgICAgIC8vIGhhdmUgYSBwb2ludGVyIHdlIGNhbiB1c2UgdG8gd29yayB3aXRoIHRoZSBvYmplY3QgZGlyZWN0bHkuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8geyBuYW1lOiBcIl9fdHJhY2VJZGVudGlmaWVyXCIsIHZhbHVlOiB0cmFjZUlkZW50aWZpZXIgfSxcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyAvLyBrZWVwIHRoZSB0cmFjZUxpc3RlbmVyIHJlZ2lzdGVyZWQgd2l0aCB0aGUgb2JqZWN0IHNvIHRoYXQgSSBjYW5cbiAgICAgICAgICAgIC8vIC8vIHZlcmlmeSB0aGF0IHRoZSBvYmplY3Qgd2UncmUgd29ya2luZyB3aXRoIGlzIGFjdHVhbGx5IGJlaW5nIHVzZWRcbiAgICAgICAgICAgIC8vIC8vIHdpdGggdGhlIHNhbWUgdHJhY2UgYW5kIG5vdCBiZWluZyByZS10cmFjZWQgYnkgc29tZXRoaW5nIGVsc2UuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8geyBuYW1lOiBcIl9fdHJhY2VMaXN0ZW5lcnNcIiwgdmFsdWU6IHRyYWNlTGlzdGVuZXJzIH0sXG5cbiAgICAgICAgICAgIC8vIGtlZXAgdGhlIHBhdGggdG8gdGhpcyBvYmplY3QgZm9yIGRlYnVnIHB1cnBvc2VzLlxuICAgICAgICAgICAgLy8geyBuYW1lOiBcIl9fcGF0aFwiLCB2YWx1ZTogcGF0aCB9XG5cbiAgICAgICAgXTtcblxuICAgICAgICAvLyBwcml2YXRlTWVtYmVycy5mb3JFYWNoKHByaXZhdGVNZW1iZXIgPT4ge1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgaWYoISAocHJpdmF0ZU1lbWJlci5uYW1lIGluIHZhbHVlKSkge1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgIC8vIHRoZSBfX3RyYWNlSWRlbnRpZmllciBpcyBhIHVuaXF1ZSBrZXkgZm9yIHRoZSBvYmplY3Qgd2hpY2ggd2UgdXNlXG4gICAgICAgIC8vICAgICAgICAgLy8gdG8gaWRlbnRpZnkgd2hpY2ggb25lIGlzIGJlaW5nIHRyYWNlZC4gIFRoaXMgd2F5IHdlIGVzc2VudGlhbGx5XG4gICAgICAgIC8vICAgICAgICAgLy8gaGF2ZSBhIHBvaW50ZXIgd2UgY2FuIHVzZSB0byB3b3JrIHdpdGggdGhlIG9iamVjdCBkaXJlY3RseS5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodmFsdWUsIHByaXZhdGVNZW1iZXIubmFtZSwge1xuICAgICAgICAvLyAgICAgICAgICAgICB2YWx1ZTogcHJpdmF0ZU1lbWJlci52YWx1ZSxcbiAgICAgICAgLy8gICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIC8vICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZVxuICAgICAgICAvLyAgICAgICAgIH0pO1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvL1xuICAgICAgICAvLyB9KTtcblxuICAgICAgICAvLyBUT0RPOiBkbyB0aGlzIGluIHRoZSBUcmFjZUhhbmRsZXIgZ2V0IG1ldGhvZD9cblxuICAgICAgICBpZih2YWx1ZS5hZGRUcmFjZUxpc3RlbmVyKSB7XG4gICAgICAgICAgICB2YWx1ZS5hZGRUcmFjZUxpc3RlbmVyKHRyYWNlTGlzdGVuZXJzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh2YWx1ZSwgXCJhZGRUcmFjZUxpc3RlbmVyXCIsIHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdHJhY2VIYW5kbGVyLmFkZFRyYWNlTGlzdGVuZXIuYmluZCh0cmFjZUhhbmRsZXIpLFxuICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IFByb3h5KHZhbHVlLCB0cmFjZUhhbmRsZXIpO1xuXG4gICAgfVxuXG59XG5cblxuIl19