<html>
<head>
    <style>

        .content {
            width: 1020px;
        }

        .raw-highlighted-text {
            color: red;

        }

        body {
            line-height: 1.8em !important;
        }

        p {
        }

        .text-highlight {

            background-color: yellow;
            opacity: 0.4;
            /*cursor: pointer;*/

        }


    </style>

    <!-- TODO

    - ability to select text WITHIN the highlight still?
    - ability to clear the highlight
    -

    -->

    <!--

    how to highlight specific text programaticallly?

    https://stackoverflow.com/questions/11128130/select-text-in-javascript
    -->

    <!--

    Design if the text is setup like this:

    tttttttttttttttttttttthhhhhhhhhhh
    hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh
    hhhhhhhhhhttttttttttttttttttttttt

    where 't' is a regular char and 'h'
    is a highlighted char and each
    line is its own div then we need to:

    1.  Break it up into spans, one per div.

    This would turn it into:

    tttttttttttttttttttttt<span class="text-highlight" id="text-highlight-101">hhhhhhhhhhh</span>
    <span class="text-highlight" id="text-highlight-101">hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh</span>
    <span class="text-highlight" id="text-highlight-101">hhhhhhhhhh</span>ttttttttttttttttttttttt

    2. this would give us 3 spans over 3 divs.

    This is necessary because pdf.js breaks the text up across rows.

    Then I need to compute three BCRs, one for each highlight, that is vertically
    adjacent to the next one, factoring in line height.

    it would look like this:

    +----------------------------+
    |                            |
    | ttttttttttttthhhhhhhhhhhhh |
    |                            |
    +============================+
    |                            |
    | hhhhhhhhhhhhhhhhhhhhhhhhhh |
    |                            |
    +----------------------------+

    This is necessary to factor in vertical line height.

    3.  Then we just draw a div within on the page at each one of the highlights.


    -->

    <script src="js/optional.js"></script>
    <script src="js/utils.js"></script>

    <script src="js/text-highlights.js"></script>
    <script src="../lib/TextHighlighter.js"></script>

</head>

<body>

<div class="content">

    <p>

    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  <span class="raw-highlighted-text text-highlight-0001">this is some text.  this is some text.  this is some text.  </span></div>
    <div><span class="raw-highlighted-text text-highlight-0001">this is some text.  this is some text.  this is some text.  this is some text.  </span></div>
    <div><span class="raw-highlighted-text text-highlight-0001">this is some text.  this is some text.  this is some text.  this is some text.  </span></div>
    <div><span class="raw-highlighted-text text-highlight-0001">this is some text.  this is some text.  this is some text.  </span>this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>

    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  <span class="raw-highlighted-text text-highlight-0002">this is some text.  this is some text.  this is some text.  </span></div>
    <div><span class="raw-highlighted-text text-highlight-0002">this is some text.  this is some text.  this is some text.  this is some text.  </span></div>
    <div><span class="raw-highlighted-text text-highlight-0002">this is some text.  this is some text.  this is some text.  this is some text.  </span></div>
    <div><span class="raw-highlighted-text text-highlight-0002">this is some text.  this is some text.  this is some text.  </span>this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>
    <div>this is some text.  this is some text.  this is some text.  this is some text.  </div>

    </p>

</div>

<script>

    // FIXME: I should probably create some code to just statically render a page
    // with various highlights and then make sure they work properly by (probably)
    // comparing the DOM before and AFTER.

    function createHighlight() {

        // FIXME use all the lighlights

        var boundingClientRect = window.getSelection().getRangeAt(0).getBoundingClientRect();

        createHighlightForRect(boundingClientRect);

    }

    function createHighlightForElement(element) {
        createHighlightForRect(element.getBoundingClientRect());
    }

    function createHighlightForRect(boundingClientRect) {

        var highlightElement = document.createElement("div");

        highlightElement.className = "text-highlight";
        highlightElement.style.position = "absolute";
        highlightElement.style.left = `${boundingClientRect.left}px`;
        highlightElement.style.top = `${boundingClientRect.top}px`;
        highlightElement.style.width = `${boundingClientRect.width}px`;
        highlightElement.style.height = `${boundingClientRect.height}px`;

        // FIXME: insert this into the page element.. to the parent div... there is a
        // get common parent method that I should probably use.

        document.body.appendChild(highlightElement);

        // FIXME: now clear the selection once this is done.

        // FIXME: the highlight should/could be BELOW the text and probably should
        // be until it's deleted I think.


    }

    //createHighlightForElement(document.querySelector("#myHighlight1"));

    var sequence = 0;

    var textHighlighterOptions = {

        highlightedClass: "text-highlight-span",
        color: '', // this works and the color isn't changed.
        manual: true,

        onBeforeHighlight: function (range) {
            console.log("onBeforeHighlight range: ", range);
            return true;
        },
        onAfterHighlight: function (range, highlightElements) {
            console.log("onAfterHighlight range: ", range);
            console.log("onAfterHighlight hlts: ", highlightElements);

            // FIXME: also give them a custom CSS class

            var id = sequence++;
            var highlightClazz = "text-highlight-" + id;

            highlightElements.forEach(function (highlightElement) {
                highlightElement.style.color = 'blue';
                highlightElement.className = highlightElement.className + " " + highlightClazz;
            })

            // FIXME: use the highlightElements to get the text of the nodes
            // then compute a hashcode to determine the ID of the highlight.

            TextHighlight.create("." + highlightClazz);

        },

        onRemoveHighlight: function (hlt) {
            console.log("onRemoveHighlight hlt: ", hlt);
        }

    };

    // in the future we
    // 're going to be able to do this ourselves...
    var textHighlighter = new TextHighlighter(document.body, textHighlighterOptions);

    function keyBindingListener(event) {

        if (event.ctrlKey && event.altKey) {

            const aCode = 65;

            switch (event.which) {

                case aCode:
                    textHighlighter.doHighlight();
                    break;

                default:
                    break;

            }

        }

    }

    function listenForKeyBindings() {
        document.addEventListener("keyup", keyBindingListener);
    }

    listenForKeyBindings();

</script>

</body>
</html>
